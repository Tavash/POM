<div ng-cloak>
  <md-content class="md-whiteframe-z2 move-up">
    <md-tabs md-dynamic-height md-border-bottom>

      <md-tab>
        <md-tab-label>Dashboard</md-tab-label>
        <md-tab-body>
          <md-content layout-padding>

            <md-grid-list
              md-cols-xs="1" md-cols-sm="2" md-cols-md="4" md-cols-gt-md="6"
              md-row-height-gt-md="1:1" md-row-height="2:2"
              md-gutter="12px" md-gutter-gt-sm="30px" >

              <md-grid-tile md-whiteframe="2" class="red-tile tile-effect" ng-click="mainVm.showTasks(mainVm.urgentTasks)">
                <h2 class="white-text tile-content"> {{mainVm.nbUrgentTasks}} </h2>
                <md-grid-tile-footer>
                  <h3 class="white-text">Tâches prioritaires</h3>
                </md-grid-tile-footer>
              </md-grid-tile>

              <md-grid-tile md-whiteframe="2" class="blue-tile tile-effect"  ng-click="mainVm.showTasks(mainVm.upcomingTasks)">
                <h2 class="white-text tile-content"> {{mainVm.nbUpcomingTasks}} </h2>
                <md-grid-tile-footer>
                  <h3 class="white-text">Tâches à venir</h3>
                </md-grid-tile-footer>
              </md-grid-tile>

              <md-grid-tile md-whiteframe="2" class="orange-tile tile-effect" ng-click="mainVm.showTasks(mainVm.newTasks)">
                <h2 class="white-text tile-content"> {{mainVm.nbNewTasks}} </h2>
                <md-grid-tile-footer>
                  <h3 class="white-text">Nouvelles tâches</h3>
                </md-grid-tile-footer>
              </md-grid-tile>

              <md-grid-tile md-whiteframe="2" class="green-tile tile-effect" ng-click="mainVm.showTasks(mainVm.completedTasks)">
                <h2 class="white-text tile-content"> {{mainVm.nbCompletedTasks}} </h2>
                <md-grid-tile-footer>
                  <h3 class="white-text">Tâches terminées</h3>
                </md-grid-tile-footer>
              </md-grid-tile>

              <md-grid-tile md-whiteframe="2" class="gray-tile tile-effect" ng-click="mainVm.showTasks(mainVm.canceledTasks)">
                <h2 class="tile-content"> {{mainVm.nbCanceledTasks}} </h2>
                <md-grid-tile-footer>
                  <h3 class="white-text">Tâches annulées</h3>
                </md-grid-tile-footer>
              </md-grid-tile>

              <md-grid-tile md-whiteframe="2" class="tile-effect" ng-click="mainVm.showTasks(mainVm.allTasks)">
                <h2 class="tile-content"> {{mainVm.allTasks.length}} </h2>
                <md-grid-tile-footer>
                  <h3 class="white-text">Toutes mes tâches</h3>
                </md-grid-tile-footer>
              </md-grid-tile>

            </md-grid-list>
            <br>
            <div layout flex layout-align="center">
              <div md-whiteframe="2" layout-padding>
                <table ng-table="mainVm.tableParams" show-filter="false" class="table table-striped table-hover">
                  <tr ng-repeat="row in $data" ng-dblClick="mainVm.redirectTasksDetails($event, row._id, row.projet_id)">
                    <td title="'Code'" filter="{code: 'text'}" sortable="'code'"><a ui-sref="projects.details.tasks.details({idtask:row._id, id: row.projet_id})"> <b>{{ row.code }}</b> </a></td>
                    <td title="'Libelle'" filter="{libelle: 'text'}" sortable="'libelle'"><a ui-sref="projects.details.tasks.details({idtask:row._id, id: row.projet_id})"> <b>{{ row.libelle }}</b> </a></td>

                    <td title="'Date début'" filter="{date_debut: 'text'}" sortable="'date_debut'">{{row.date_debut | date:"dd/MM/yyyy" }}</td>

                    <td title="'Statut'" sortable="'statut.statut'"><span class="{{row.statut.class}}" style="color:{{row.statut.color}};font-size:1.5em;"><md-tooltip md-direction="left">{{row.statut.statut}}</md-tooltip></span></td>

                    <td title="'Catégorie'" filter="{categorie: 'text'}" sortable="'categorie.name'"><kbd style="background-color:{{row.categorie.color}}">{{ row.categorie.name }}</kbd></td>

                    <td title="'Dernière modification'" filter="{date_derniere_modif: 'text'}" sortable="'date_derniere_modif'" >{{ row.date_derniere_modif | date:"dd/MM/yyyy 'à' HH:mm:ss" }}</td>

                  </tr>
                </table>
              </div>
            </div>
          </md-content>
        </md-tab-body>
      </md-tab>

      <md-tab>
        <md-tab-label>Mes projets  <span class="badge" style="background-color:red">{{mainVm.numberProjects}}</span></md-tab-label>
        <md-tab-body>
          <md-content class="md-padding" layout>

            <div flex="35">
              <md-list flex="">
                <md-list-item class="md-2-line" ng-repeat="project in mainVm.projects">

                  <div class="md-list-item-text" layout="column">

                    <h3> <a ui-sref="projects.details.info({id:project._id})"> {{ project.nom }} </a></h3>

                    <p>Durée théorique <b>totale</b> du projet : <b> {{ project.duration }} </b></p>

                    <p>Durée théorique <b>restante</b> du projet : <b> {{ project.leftDuration }} </b></p>

                    <p>Durée théorique <b>passée</b> du projet : <b> {{ project.passedDuration }} </b></p>

                    <p>Nombre de collaborateurs affectés au projet : <b> {{ project.collaborateurs.length }} </b></p>


                    <p>Statut du projet : <b>{{ project.statut }} </b></p>

                    <br>

                    <!-- Par rapport à la ligne budgétaire(budget)-->
                    <p>Avancement théorique du projet ({{ project.advancement }}% du budget)</p>
                    <md-progress-linear md-mode="determinate" value="{{ project.advancement }}"></md-progress-linear>

                    <div class="progressBarClass" id="progressLineBudgetProject"></div>

                    <br>

                    <!-- Par rapport à la durée (date)-->
                    <p>Avancement théorique du projet ({{ project.timeAdvancement }}% de la durée théorique)</p>
                    <md-progress-linear md-mode="determinate" value="{{ project.timeAdvancement }}"></md-progress-linear>

                    <div class="progressBarClass" id="progressLineDateProject"></div>

                    <br>
                    <br>

                  </div>

                </md-list-item>

              </md-list>
            </div>
          </md-content>
        </md-tab-body>
      </md-tab>

      <md-tab>
        <md-tab-label>Mes tâches  <span class="badge" style="background-color:red">{{mainVm.tasks.length}}</span></md-tab-label>
        <md-tab-body>
          <md-content class="md-padding" layout >

            <div flex="35">
              <md-list flex="">
                <md-list-item class="md-2-line" ng-repeat="task in mainVm.tasks">

                  <div class="md-list-item-text" layout="column">

                    <h3> <a ui-sref="projects.details.tasks.details({id:task.projet_id, idtask:task._id})"> {{ task.libelle }} </a></h3>

                    <p>Statut de la tâche : <b> {{ task.statut }}</b></p>

                    <p>Durée de la tâche : <b> {{ task.duration }}</b></p>

                    <p>Durée théorique <b>restante</b> de la tâche : <b> {{ task.leftDuration }} </b></p>

                    <p>Durée théorique <b>passée</b> de la tâche : <b> {{ task.passedDuration }} </b></p>

                    <p>Coût théorique <b>total</b> de la tâche : <b> {{ task.totalCost }} </b></p>

                    <p>Coût théorique <b>au jour</b> de la tâche : <b> {{ task.nowCost }} </b></p>

                    <br>

                    <p>Avancement théorique de la tâche ({{ task.advancement }}% du budget)</p>
                    <md-progress-linear md-mode="determinate" value="{{ task.advancement }}"></md-progress-linear>

                    <div class="progressBarClass" id="progressLineBudgetTask"></div>

                    <!-- Par rapport à la durée (date)-->
                    <!--<p>Avancement théorique de la tâche ({{ task.advancement }}% du budget)</p>
                    <md-progress-linear md-mode="determinate" value="{{ task.advancement }}"></md-progress-linear>-->

                    <br>

                  </div>

                </md-list-item>
              </md-list>
            </div>
          </md-content>
        </md-tab-body>
      </md-tab>
    </md-tabs>
  </md-content>
</div>
